<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Urban Jungle Staff Tools</title>
    <meta
      name="description"
      content="Launch Urban Jungle internal tools secured behind Cloudflare Zero Trust."
    />
    <style>
      :root {
        color-scheme: light dark;
        --bg: #f3f4f6;
        --bg-alt: #ffffff;
        --accent: #8b1c23;
        --accent-soft: rgba(139, 28, 35, 0.12);
        --text: #1f2937;
        --text-muted: #4b5563;
        --border: rgba(31, 41, 55, 0.08);
        font-synthesis: none;
        text-rendering: optimizeLegibility;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.5;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      header {
        padding: 56px 24px 64px;
        background: radial-gradient(circle at 20% -20%, rgba(171, 49, 57, 0.32), transparent 55%),
          linear-gradient(145deg, rgba(107, 24, 30, 0.95), rgba(139, 28, 35, 0.92));
        color: #fff;
        text-align: center;
      }

      header h1 {
        margin: 0;
        font-size: clamp(2rem, 5vw, 3rem);
        font-weight: 700;
        letter-spacing: -0.02em;
      }

      header p {
        margin: 16px auto 0;
        max-width: 600px;
        font-size: 1.05rem;
        color: rgba(255, 255, 255, 0.85);
      }

      main {
        flex: 1;
        width: min(1100px, calc(100% - 32px));
        margin: -48px auto 32px;
      }

      section {
        background: var(--bg-alt);
        border-radius: 18px;
        padding: 32px;
        box-shadow: 0 12px 30px -24px rgba(15, 23, 42, 1);
        border: 1px solid var(--border);
      }

      .tool-group {
        border-radius: 18px;
        padding: 28px;
        background: linear-gradient(135deg, rgba(139, 28, 35, 0.06), rgba(139, 28, 35, 0));
        border: 1px solid rgba(139, 28, 35, 0.12);
        box-shadow: 0 10px 28px -24px rgba(139, 28, 35, 0.7);
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .group-heading {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .group-title, .tool-name {
        margin: 0;
        font-size: 1.2rem;
        font-weight: 600;
        letter-spacing: -0.01em;
        color: var(--text);
      }

      .group-description {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.95rem;
      }

      .group-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 16px;
      }

      .group-button {
        display: flex;
        flex-direction: column;
        gap: 6px;
        padding: 18px 20px;
        border-radius: 14px;
        background: var(--bg-alt);
        color: var(--accent);
        border: 1px solid rgba(139, 28, 35, 0.25);
        text-decoration: none;
        font-weight: 600;
        letter-spacing: -0.01em;
        box-shadow: 0 12px 24px -20px rgba(15, 23, 42, 0.25);
        transition: transform 150ms ease, box-shadow 150ms ease, background 150ms ease, color 150ms ease;
      }

      .group-button:hover,
      .group-button:focus-visible {
        transform: translateY(-3px);
        box-shadow: 0 18px 30px -24px rgba(15, 23, 42, 0.32);
        background: rgba(139, 28, 35, 0.08);
        color: var(--accent);
      }

      .group-button-label {
        font-size: 1rem;
      }

      .group-button-name {
        font-size: 0.85rem;
        font-weight: 500;
        opacity: 0.9;
        color:var(--text-muted)
      }

      #tool-content > * + * {
        margin-top: 32px;
      }

      .tools-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 20px;
      }

      .tool-card {
        background: linear-gradient(135deg, rgba(139, 28, 35, 0.08), rgba(139, 28, 35, 0));
        border-radius: 16px;
        padding: 24px;
        border: 1px solid rgba(139, 28, 35, 0.12);
        display: flex;
        flex-direction: column;
        gap: 12px;
        transition: transform 160ms ease, box-shadow 160ms ease;
      }

      .tool-card:hover,
      .tool-card:focus-within {
        transform: translateY(-4px);
        box-shadow: 0 12px 30px -20px rgba(139, 28, 35, 0.55);
      }

      .tool-card a {
        text-decoration: none;
        color: inherit;
        display: flex;
        flex-direction: column;
        gap: 12px;
        flex: 1;
      }

      

      .tool-description {
        color: var(--text-muted);
        margin: 0;
        font-size: 0.95rem;
      }

      .tool-meta {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .meta-pill {
        padding: 6px 10px;
        border-radius: 999px;
        background: var(--accent-soft);
        color: var(--accent);
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        text-transform: uppercase;
      }

      .loading-state,
      .empty-state,
      .error-state {
        margin: 0;
        color: var(--text-muted);
        text-align: center;
        padding: 24px 0;
      }

      footer {
        text-align: center;
        padding: 24px;
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      @media (max-width: 640px) {
        header {
          padding: 48px 18px 28px;
        }

        section {
          padding: 24px;
        }

        .tool-group {
          padding: 22px;
        }

        .group-buttons {
          grid-template-columns: 1fr;
        }

        .group-button {
          padding: 16px 18px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Urban Jungle Staff Hub</h1>
      <p>Launch the internal tools you need every day. Access is restricted to Urban Jungle staff.</p>
    </header>

    <main>
      <section aria-labelledby="tools-heading">
        <h2 id="tools-heading" style="margin-top: 0; margin-bottom: 24px; font-size: 1.25rem">
          Available Tools
        </h2>
        <div id="tool-content">
          <p class="loading-state" role="status">Loading toolsâ€¦</p>
        </div>
      </section>
    </main>

    <footer>Questions or missing something? Reach out to the digital team.</footer>

    <script>
      async function loadTools() {
        const container = document.getElementById("tool-content");
        try {
          const response = await fetch("tools.json", { cache: "no-store" });
          if (!response.ok) throw new Error("Unable to fetch tools");

          const payload = await response.json();

          const assembledEntries = [];

          if (Array.isArray(payload?.entries)) {
            assembledEntries.push(...payload.entries);
          } else {
            if (Array.isArray(payload?.groups)) {
              for (const group of payload.groups) {
                assembledEntries.push({ type: "group", ...group });
              }
            }
            if (Array.isArray(payload?.tools)) {
              for (const tool of payload.tools) {
                assembledEntries.push({ type: "tool", ...tool });
              }
            }
          }

          if (!assembledEntries.length) {
            container.innerHTML =
              '<p class="empty-state" role="status">No tools are published here yet.</p>';
            return;
          }

          const fragment = document.createDocumentFragment();
          let pendingGrid = null;
          const flushGrid = () => {
            if (pendingGrid?.childElementCount) {
              fragment.appendChild(pendingGrid);
            }
            pendingGrid = null;
          };

          let hasRenderableContent = false;

          for (const entry of assembledEntries) {
            if (!entry || typeof entry !== "object") continue;
            const type = String(entry.type ?? "").toLowerCase();

            if (type === "group") {
              const items = Array.isArray(entry.items)
                ? entry.items.filter((item) => item?.path)
                : [];
              if (!items.length) continue;

              flushGrid();
              const groupCard = document.createElement("article");
              groupCard.className = "tool-group";
              if (entry.id) {
                groupCard.setAttribute("data-group-id", entry.id);
              }

              const heading = document.createElement("div");
              heading.className = "group-heading";

              const title = document.createElement("h3");
              title.className = "group-title";
              title.textContent = entry.name ?? "Tool Group";
              heading.appendChild(title);

              if (entry.description) {
                const blurb = document.createElement("p");
                blurb.className = "group-description";
                blurb.textContent = entry.description;
                heading.appendChild(blurb);
              }

              groupCard.appendChild(heading);

              const buttons = document.createElement("div");
              buttons.className = "group-buttons";

              for (const item of items) {
                const button = document.createElement("a");
                button.className = "group-button";
                button.href = item.path;

                if (item.id || item.name) {
                  const identifier =
                    item.id ??
                    (typeof item.name === "string"
                      ? item.name.toLowerCase().replace(/\s+/g, "-")
                      : undefined);
                  if (identifier) {
                    button.setAttribute("data-tool-id", identifier);
                  }
                }

                const label = document.createElement("span");
                label.className = "group-button-label";
                label.textContent =
                  item.buttonText ??
                  (item.name ? `Open ${item.name}` : "Open tool");
                button.appendChild(label);

                if (item.name) {
                  const name = document.createElement("span");
                  name.className = "group-button-name";
                  name.textContent = item.name;
                  button.appendChild(name);
                }

                buttons.appendChild(button);
              }

              groupCard.appendChild(buttons);
              fragment.appendChild(groupCard);
              hasRenderableContent = true;
            } else if (type === "tool") {
              if (!entry.path || !entry.name) continue;

              if (!pendingGrid) {
                pendingGrid = document.createElement("div");
                pendingGrid.className = "tools-grid";
              }

              const card = document.createElement("article");
              card.className = "tool-card";

              const link = document.createElement("a");
              link.href = entry.path;
              link.setAttribute(
                "data-tool-id",
                entry.id ?? entry.name.toLowerCase()
              );

              const name = document.createElement("h3");
              name.className = "tool-name";
              name.textContent = entry.name;

              const description = document.createElement("p");
              description.className = "tool-description";
              description.textContent =
                entry.description ?? "Launch the tool.";

              link.append(name, description);

              if (entry.category || entry.status) {
                const meta = document.createElement("div");
                meta.className = "tool-meta";
                if (entry.category) {
                  const pill = document.createElement("span");
                  pill.className = "meta-pill";
                  pill.textContent = entry.category;
                  meta.appendChild(pill);
                }
                if (entry.status) {
                  const pill = document.createElement("span");
                  pill.className = "meta-pill";
                  pill.textContent = entry.status;
                  meta.appendChild(pill);
                }
                link.appendChild(meta);
              }

              card.appendChild(link);
              pendingGrid.appendChild(card);
              hasRenderableContent = true;
            }
          }

          flushGrid();

          if (!hasRenderableContent) {
            container.innerHTML =
              '<p class="empty-state" role="status">No tools are published here yet.</p>';
            return;
          }

          container.replaceChildren(fragment);
        } catch (error) {
          console.error(error);
          container.innerHTML =
            '<p class="error-state" role="alert">We ran into a problem loading the tools. Please refresh or try again later.</p>';
        }
      }

      loadTools();
    </script>
  </body>
</html>
